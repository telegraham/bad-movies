function getMovieLiById(e){return document.querySelector(`#movie-${e}`)}function renderMovieListItem(e,t){const i=document.createElement("li");return i.id=`movie-${e.id}`,i.dataset.id=e.id,i.className="movie js-movie",i.innerText=e.title,!0===t&&selectThisMovie(i),i}function deselectAllMovies(){const e=document.querySelector(".selected");e&&e.classList.remove("selected")}function selectThisMovie(e){e.classList.add("selected")}function writeCastMemberFormLi(e){return`<li>\n    <input type="text" class="js-movie-cast-member" name="movie-cast-member" value="${e}"/>\n    <button class="remove-from-cast">remove</button>\n  </li>`}function writeForm(e,t){const i=(t.cast||[""]).map(writeCastMemberFormLi).join("");return console.log(i),`<h2>${e}</h2>\n    <form class="movie-form js-movie-form">\n      <input id="movie-id" name="movie-id" type="hidden" value="${t.id}"/>\n      <ul>\n        <li>\n          <label for="movie-title">Title</label>\n          <input id="movie-title" name="movie-title" type="text" value="${t.title}" />\n        </li>\n        <li>\n          <label for="movie-year">Year</label>\n          <input id="movie-year" name="movie-year" type="number" value="${t.year}" />\n        </li>\n        <li class="cast-inputs-container">\n          <label>Cast</label>\n          <ul class="js-cast-inputs cast-inputs">\n            ${i}\n          </ul>\n          <button class="add-to-cast">add</button>\n        </li>\n      </ul>\n      <input type="submit" />\n    </form>`}function delegateCastClicks(e){e.addEventListener("click",function(e){e.target.classList.contains("remove-from-cast")&&(e.preventDefault(),e.target.parentNode.remove()),e.target.classList.contains("add-to-cast")&&(e.preventDefault(),document.querySelector(".js-cast-inputs").innerHTML+=writeCastMemberFormLi(""))})}function delegateFormSubmit(e,t){e.addEventListener("submit",function(i){i.preventDefault();const n=readForm(i.target);n.id.length?updateMovie(n,e):newMovie(n,e,t)})}function readForm(e){return{id:e.querySelector("#movie-id").value,title:e.querySelector("#movie-title").value,year:e.querySelector("#movie-year").value,cast:Array.from(e.querySelectorAll(".js-movie-cast-member")).map(e=>e.value)}}function slapMoviesOnTheDom(e,t){e.map(renderMovieListItem).forEach(e=>t.append(e))}function addMoviesToList(e){fetch("http://localhost:3000/movies").then(e=>e.json()).then(t=>slapMoviesOnTheDom(t,e))}function delegateShowClick(e,t){e.addEventListener("click",function(e){e.target.classList.contains("js-movie")&&showMovie(e.target.dataset.id,e.target,t)})}function showMovie(e,t,i){deselectAllMovies(),selectThisMovie(t),i.classList.add("loading"),fetch(`http://localhost:3000/movies/${e}`).then(e=>e.json()).then(e=>slapMovieOnTheDetail(e,i))}function slapMovieOnTheDetail(e,t){t.classList.remove("loading"),t.dataset.id=e.id;const i=e.cast.map(e=>`<li class="cast-member">${e}</li>`).join("");t.innerHTML=`\n    <h2><span class="js-title">${e.title}</span> (<span class="js-year">${e.year}</span>)</h2>\n    <ul>\n      ${i}\n    </ul>\n    <button class="js-edit">Edit</button>\n    <button data-id="${e.id}" class="js-delete danger">Delete</button>\n  `}function delegateEditClick(e){e.addEventListener("click",function(t){t.target.classList.contains("js-edit")&&editMovie(e)})}function editMovie(e){const t=e.querySelector(".js-title").innerText,i=e.querySelector(".js-year").innerText,n=Array.from(e.querySelectorAll(".cast-member")).map(e=>e.innerText),o={id:e.dataset.id,title:t,year:i,cast:n};e.innerHTML=writeForm("Edit Movie",o)}function updateMovie(e,t){fetch(`http://localhost:3000/movies/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>slapMovieOnTheDetail(e,t)),getMovieLiById(e.id).innerText=e.title}function showNewMovieForm(e){e.innerHTML=writeForm("New Movie",{title:"",year:"",id:""})}function newMovie(e,t,i){fetch("http://localhost:3000/movies/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{slapMovieOnTheDetail(e,t),deselectAllMovies(),i.append(renderMovieListItem(e,!0))})}function delegateDeleteClick(e,t,i){e.addEventListener("click",function(t){t.target.classList.contains("js-delete")&&deleteMovie(t.target.dataset.id,e,i)})}function deleteMovie(e,t,i){fetch(`http://localhost:3000/movies/${e}`,{method:"DELETE"}).then(()=>scapeItOffTheDom(e,t,i))}function scapeItOffTheDom(e,t,i){t.innerHTML=i,getMovieLiById(e).remove()}document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".js-movies"),t=document.querySelector(".js-detail"),i=document.querySelector(".js-add-movie"),n=t.innerHTML;addMoviesToList(e),delegateShowClick(e,t),delegateEditClick(t),delegateDeleteClick(t,e,n),delegateFormSubmit(t,e),delegateCastClicks(t),i.addEventListener("click",function(e){showNewMovieForm(t)})});